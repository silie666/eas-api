import{a as k,u as v,_ as y}from"./hooks-2d8c7479.js";import{d as T,W as L,n as w,r as B,o as A,i as S,j as h,e as g,f as s,ar as t,u as D,av as f,at as H,ad as I,au as C,aG as x,b as $,c as V,w as O,h as U,A as M,B as F}from"./index-c5917c64.js";import{C as _}from"./course-course-bill-api-819ca1f7.js";import{B as N}from"./basic-simple-api-bdc4060a.js";import{_ as W}from"./index.vue_vue_type_script_setup_true_lang-ea29dbbc.js";import{a as Y}from"./hooks-f415898c.js";import"./search-cc37b371.js";import"./baseData-44696a71.js";const Z=T({__name:"BillForm",props:{row:{}},setup(l,{expose:c}){var u;const n=l,i=L({course_ids:((u=n==null?void 0:n.row)==null?void 0:u.course_ids)??""}),p=k(new N().getApiCommonApiCourses,"id"),r=w();return c({ruleFormRef:r,form:i}),(e,o)=>{const a=B("el-form-item"),d=B("el-form");return A(),S(d,{ref_key:"ruleFormRef",ref:r,model:i,"label-width":"100px"},{default:h(()=>[g(a,{label:s(t)("课程"),prop:"course_ids"},{default:h(()=>[g(W,{options:s(p),modelValue:i.course_ids,"onUpdate:modelValue":o[0]||(o[0]=m=>i.course_ids=m),"collapse-tags":"",multiple:"",placeholder:s(t)("课程")},null,8,["options","modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])}}});function P(){const l=v(new _().getApiTeacherApiCourseBills),{getTableData:c}=l,{push:n}=D(),i={add:{auth:f.POST_TEACHER_COURSE_BILLS,onClick(){u()}},detail:{auth:f.GET_TEACHER_COURSE_BILLS_BY_ID,onClick({id:e}){n({name:"BillDetail",params:{courseBillId:e}})}},edit:{auth:f.PATCH_TEACHER_COURSE_BILLS_BY_ID,onClick(e){u(t("编辑"),e)}},delete:{auth:f.DELETE_TEACHER_COURSE_BILLS_BY_ID,onConfirm({id:e}){l.handleDelete(new _().deleteApiTeacherApiCourseBill,{courseBillId:e})}}},p=[{label:t("序号"),type:"index",width:70},{label:t("课程名称"),prop:"courses",minWidth:90,cellRenderer:e=>{const o=[];let a;for(a of e.row.courses)e.row.course_ids.includes(a.id)&&o.push(a.name);return o.join(",")}},{label:t("是否已发送账单"),prop:"status_name",minWidth:130},{label:t("创建时间"),prop:"create_time",minWidth:130},{label:t("操作"),width:200,slot:"operation"}];function r(e){x.confirm("确认要发送账单?","系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(async()=>{await new _().patchApiTeacherApiCourseBillSend({courseBillId:e.id.toString()}),C(t("操作成功"),{type:"success"}),await c()}).catch(()=>{C(t("操作失败"),{type:"error"})})}function u(e=t("新增"),o){const a=w();H({title:`${e}${t("账单")}`,width:"40%",draggable:!0,fullscreenIcon:!0,closeOnClickModal:!1,loading:!1,contentRenderer:()=>I(Z,{ref:a,row:o}),beforeSure:(d,{options:m})=>{const{form:E,ruleFormRef:R}=a.value;R.validate(async b=>{if(b){m.loading=!0;try{o?await new _().patchApiTeacherApiCourseBill({courseBillId:o.id.toString(),patchApiTeacherApiCourseBillRequest:E}):await new _().postApiTeacherApiCourseBills({patchApiTeacherApiCourseBillRequest:E}),C(`${e}成功`,{type:"success"}),d(),await c()}finally{m.loading=!1}}})}})}return{columns:p,onSend:r,hook:l,actionBtn:i}}const j={width:24,height:24,body:'<path fill="currentColor" d="M20 22H4a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1h16a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1Zm-1-2V4H5v16h14ZM8 9h8v2H8V9Zm0 4h8v2H8v-2Z"/>'},q={class:"main"},oe=T({name:"BillList",__name:"index",setup(l){const{columns:c,onSend:n,hook:i,actionBtn:p}=P();return(r,u)=>{const e=B("el-button"),o=$("auth");return A(),V("div",q,[g(y,{title:r.$t("账单管理"),columns:s(c),hook:s(i),"action-btn":s(p)},{operation:h(({row:a,size:d})=>[a.status===!1?O((A(),S(e,{key:0,icon:s(Y)(s(j)),size:d,class:"reset-margin",link:"",type:"primary",onClick:m=>s(n)(a)},{default:h(()=>[U(M(r.$t("发送账单")),1)]),_:2},1032,["icon","size","onClick"])),[[o,s(f).PATCH_TEACHER_COURSE_BILLS_BY_ID_SEND]]):F("",!0)]),_:1},8,["title","columns","hook","action-btn"])])}}});export{oe as default};
