import{a as S,u as x,_ as y}from"./hooks-2d8c7479.js";import{d as R,W as B,n as T,r as b,o as $,i as D,j as p,e as s,f as a,ar as e,av as V,at as U,ad as v,au as H,c as O}from"./index-c5917c64.js";import{C as A}from"./course-course-api-5c1bca69.js";import{B as Y}from"./basic-simple-api-bdc4060a.js";import{_ as L}from"./index.vue_vue_type_script_setup_true_lang-ea29dbbc.js";import"./hooks-f415898c.js";import"./search-cc37b371.js";import"./baseData-44696a71.js";const W=R({__name:"CourseForm",props:{row:{}},setup(u,{expose:c}){var r,i,C,f,_;const t=u,o=B({name:((r=t==null?void 0:t.row)==null?void 0:r.name)??"",content:((i=t==null?void 0:t.row)==null?void 0:i.content)??"",date:((C=t==null?void 0:t.row)==null?void 0:C.date)??"",fees:((f=t==null?void 0:t.row)==null?void 0:f.fees)??null,student_ids:((_=t==null?void 0:t.row)==null?void 0:_.student_ids)??[]}),m=S(new Y().getApiCommonApiStudents,"id"),l=T();return c({ruleFormRef:l,form:o}),(g,n)=>{const w=b("el-input"),h=b("el-form-item"),k=b("el-date-picker"),E=b("el-form");return $(),D(E,{ref_key:"ruleFormRef",ref:l,model:o,"label-width":"100px"},{default:p(()=>[s(h,{label:a(e)("课程名称"),prop:"name"},{default:p(()=>[s(w,{modelValue:o.name,"onUpdate:modelValue":n[0]||(n[0]=d=>o.name=d)},null,8,["modelValue"])]),_:1},8,["label"]),s(h,{label:a(e)("课程内容"),prop:"content"},{default:p(()=>[s(w,{modelValue:o.content,"onUpdate:modelValue":n[1]||(n[1]=d=>o.content=d),type:"textarea"},null,8,["modelValue"])]),_:1},8,["label"]),s(h,{label:`${a(e)("上课日期")}`,prop:"date"},{default:p(()=>[s(k,{modelValue:o.date,"onUpdate:modelValue":n[2]||(n[2]=d=>o.date=d),type:"month",placeholder:`${a(e)("请选择")} ${a(e)("上课日期")}`,"value-format":"YYYY-MM-DDTHH:mm:ssZ"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(h,{label:`${a(e)("费用(日元)")}`,prop:"fees"},{default:p(()=>[s(w,{modelValue:o.fees,"onUpdate:modelValue":n[3]||(n[3]=d=>o.fees=d),placeholder:`${a(e)("请输入")} ${a(e)("费用")}${a(e)("(100日元起)")}`},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(h,{label:a(e)("学生"),prop:"student_ids"},{default:p(()=>[s(L,{options:a(m),modelValue:o.student_ids,"onUpdate:modelValue":n[4]||(n[4]=d=>o.student_ids=d),"collapse-tags":"",multiple:"",placeholder:a(e)("学生")},null,8,["options","modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])}}});function F(){const u=x(new A().getApiTeacherApiCourses),{getTableData:c}=u,t={add:{auth:V.POST_TEACHER_COURSES,onClick(){m()}},edit:{auth:V.PATCH_TEACHER_COURSES_BY_ID,onClick(l){m(e("编辑"),l)}},delete:{auth:V.DELETE_TEACHER_COURSES_BY_ID,onConfirm({id:l}){u.handleDelete(new A().deleteApiTeacherApiCourse,{courseId:l})}}},o=[{label:e("序号"),type:"index",width:70},{label:e("课程名称"),prop:"name",minWidth:130,search:{type:"input"}},{label:e("上课日期"),prop:"date",minWidth:130,cellRenderer:l=>l.row.date.split("T")[0].substring(0,7)},{label:e("费用（日元）"),prop:"fees",minWidth:130},{label:e("学生"),prop:"students",minWidth:90,cellRenderer:l=>{const r=[];let i;for(i of l.row.students)l.row.student_ids.includes(i.id)&&r.push(i.name);return r.join(",")}},{label:e("操作"),width:200,slot:"operation"}];function m(l=e("新增"),r){const i=T();U({title:`${l}${e("课程")}`,width:"40%",draggable:!0,fullscreenIcon:!0,closeOnClickModal:!1,loading:!1,contentRenderer:()=>v(W,{ref:i,row:r}),beforeSure:(C,{options:f})=>{const{form:_,ruleFormRef:g}=i.value;g.validate(async n=>{if(n){f.loading=!0;try{r?await new A().patchApiTeacherApiCourse({courseId:r.id.toString(),patchApiTeacherApiCourseRequest:_}):await new A().postApiTeacherApiCourses({patchApiTeacherApiCourseRequest:_}),H(`${l}成功`,{type:"success"}),C(),await c()}finally{f.loading=!1}}})}})}return{columns:o,hook:u,actionBtn:t}}const I={class:"main"},J=R({name:"CourseList",__name:"index",setup(u){const{columns:c,hook:t,actionBtn:o}=F();return(m,l)=>($(),O("div",I,[s(y,{title:m.$t("课程管理"),columns:a(c),hook:a(t),"action-btn":a(o)},null,8,["title","columns","hook","action-btn"])]))}});export{J as default};
